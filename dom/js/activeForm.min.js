!function(t){t.fn.yiiActiveForm=function(e){return l[e]?l[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.yiiActiveForm"),!1):l.init.apply(this,arguments)};var r,e={beforeValidate:"beforeValidate",afterValidate:"afterValidate",beforeValidateAttribute:"beforeValidateAttribute",afterValidateAttribute:"afterValidateAttribute",beforeSubmit:"beforeSubmit",ajaxBeforeSend:"ajaxBeforeSend",ajaxComplete:"ajaxComplete"},i={encodeErrorSummary:!0,errorSummary:".error-summary",validateOnSubmit:!0,errorCssClass:"has-error",successCssClass:"has-success",validatingCssClass:"validating",ajaxParam:"ajax",ajaxDataType:"json",validationUrl:void 0,scrollToError:!0},a={id:void 0,name:void 0,container:void 0,input:void 0,error:".help-block",encodeError:!0,validateOnChange:!0,validateOnBlur:!0,validateOnType:!1,validationDelay:500,enableAjaxValidation:!1,validate:void 0,status:0,cancelled:!1,value:void 0},n=function(e){r=t.Deferred(),e.data("yiiSubmitFinalizePromise",r.promise())},s=function(t){r&&(r.resolve(),r=void 0,t.removeData("yiiSubmitFinalizePromise"))},l={init:function(e,r){return this.each(function(){var n=t(this);if(!n.data("yiiActiveForm")){var s=t.extend({},i,r||{});void 0===s.validationUrl&&(s.validationUrl=n.attr("action")),t.each(e,function(i){e[i]=t.extend({value:g(n,this)},a,this),d(n,e[i])}),n.data("yiiActiveForm",{settings:s,attributes:e,submitting:!1,validated:!1,target:n.attr("target")}),n.bind("reset.yiiActiveForm",l.resetForm),s.validateOnSubmit&&(n.on("mouseup.yiiActiveForm keyup.yiiActiveForm",":submit",function(){n.data("yiiActiveForm").submitObject=t(this)}),n.on("submit.yiiActiveForm",l.submitForm))}})},add:function(e){var i=t(this);e=t.extend({value:g(i,e)},a,e),i.data("yiiActiveForm").attributes.push(e),d(i,e)},remove:function(e){var i=t(this),a=i.data("yiiActiveForm").attributes,r=-1,n=void 0;return t.each(a,function(t){return a[t].id==e?(r=t,n=a[t],!1):void 0}),r>=0&&(a.splice(r,1),o(i,n)),n},validateAttribute:function(e){var i=l.find.call(this,e);void 0!=i&&u(t(this),i,!0)},find:function(e){var i=t(this).data("yiiActiveForm").attributes,a=void 0;return t.each(i,function(t){return i[t].id==e?(a=i[t],!1):void 0}),a},destroy:function(){return this.each(function(){t(this).unbind(".yiiActiveForm"),t(this).removeData("yiiActiveForm")})},data:function(){return this.data("yiiActiveForm")},validate:function(){var i=t(this),a=i.data("yiiActiveForm"),r=!1,n={},l=f(),d=a.submitting;if(d){var o=t.Event(e.beforeValidate);if(i.trigger(o,[n,l]),o.result===!1)return a.submitting=!1,void s(i)}t.each(a.attributes,function(){if(!t(this.input).is(":disabled")&&(this.cancelled=!1,a.submitting||2===this.status||3===this.status)){var s=n[this.id];void 0===s&&(s=[],n[this.id]=s);var d=t.Event(e.beforeValidateAttribute);i.trigger(d,[this,s,l]),d.result!==!1?(this.validate&&this.validate(this,g(i,this),s,l,i),this.enableAjaxValidation&&(r=!0)):this.cancelled=!0}}),t.when.apply(this,l).always(function(){for(var l in n)0===n[l].length&&delete n[l];if(t.isEmptyObject(n)&&r){var o=a.submitObject,u="&"+a.settings.ajaxParam+"="+i.attr("id");o&&o.length&&o.attr("name")&&(u+="&"+o.attr("name")+"="+o.attr("value")),t.ajax({url:a.settings.validationUrl,type:i.attr("method"),data:i.serialize()+u,dataType:a.settings.ajaxDataType,complete:function(t,a){i.trigger(e.ajaxComplete,[t,a])},beforeSend:function(t,a){i.trigger(e.ajaxBeforeSend,[t,a])},success:function(e){null!==e&&"object"==typeof e?(t.each(a.attributes,function(){(!this.enableAjaxValidation||this.cancelled)&&delete e[this.id]}),c(i,t.extend(n,e),d)):c(i,n,d)},error:function(){a.submitting=!1,s(i)}})}else a.submitting?setTimeout(function(){c(i,n,d)},200):c(i,n,d)})},submitForm:function(){var i=t(this),a=i.data("yiiActiveForm");if(a.validated){a.submitting=!1;var r=t.Event(e.beforeSubmit);return i.trigger(r),r.result===!1?(a.validated=!1,s(i),!1):(v(i),!0)}return n(i),void 0!==a.settings.timer&&clearTimeout(a.settings.timer),a.submitting=!0,l.validate.call(i),!1},resetForm:function(){var e=t(this),i=e.data("yiiActiveForm");setTimeout(function(){t.each(i.attributes,function(){this.value=g(e,this),this.status=0;var t=e.find(this.container);t.removeClass(i.settings.validatingCssClass+" "+i.settings.errorCssClass+" "+i.settings.successCssClass),t.find(this.error).html("")}),e.find(i.settings.errorSummary).hide().find("ul").html("")},1)},updateMessages:function(e,i){var a=t(this),r=a.data("yiiActiveForm");t.each(r.attributes,function(){m(a,this,e)}),i&&h(a,e)},updateAttribute:function(e,i){var a=l.find.call(this,e);if(void 0!=a){var r={};r[e]=i,m(t(this),a,r)}}},d=function(e,i){var a=p(e,i);i.validateOnChange&&a.on("change.yiiActiveForm",function(){u(e,i,!1)}),i.validateOnBlur&&a.on("blur.yiiActiveForm",function(){(0==i.status||1==i.status)&&u(e,i,!0)}),i.validateOnType&&a.on("keyup.yiiActiveForm",function(a){-1===t.inArray(a.which,[16,17,18,37,38,39,40])&&i.value!==g(e,i)&&u(e,i,!1,i.validationDelay)})},o=function(t,e){p(t,e).off(".yiiActiveForm")},u=function(e,i,a,r){var n=e.data("yiiActiveForm");a&&(i.status=2),t.each(n.attributes,function(){this.value!==g(e,this)&&(this.status=2,a=!0)}),a&&(void 0!==n.settings.timer&&clearTimeout(n.settings.timer),n.settings.timer=setTimeout(function(){n.submitting||e.is(":hidden")||(t.each(n.attributes,function(){2===this.status&&(this.status=3,e.find(this.container).addClass(n.settings.validatingCssClass))}),l.validate.call(e))},r?r:200))},f=function(){var e=[];return e.add=function(e){this.push(new t.Deferred(e))},e},c=function(i,a,r){var n=i.data("yiiActiveForm");if(r){var l=[];if(t.each(n.attributes,function(){t(this.input).is(":disabled")||this.cancelled||!m(i,this,a)||l.push(this)}),i.trigger(e.afterValidate,[a,l]),h(i,a),l.length){if(n.settings.scrollToError){var d=i.find(t.map(l,function(t){return t.input}).join(",")).first().closest(":visible").offset().top,o=t(window).scrollTop();(o>d||d>o+t(window).height())&&t(window).scrollTop(d)}n.submitting=!1}else{n.validated=!0;var u=n.submitObject?n.submitObject.attr("formtarget"):null;u&&i.attr("target",u),i.submit(),i.attr("target",n.target)}}else t.each(n.attributes,function(){this.cancelled||2!==this.status&&3!==this.status||m(i,this,a)});s(i)},v=function(e){var i=e.data("yiiActiveForm"),a=i.submitObject||e.find(":submit:first");if(a.length&&"submit"==a.attr("type")&&a.attr("name")){var r=t('input[type="hidden"][name="'+a.attr("name")+'"]',e);r.length?r.attr("value",a.attr("value")):t("<input>").attr({type:"hidden",name:a.attr("name"),value:a.attr("value")}).appendTo(e)}},m=function(i,a,r){var n=i.data("yiiActiveForm"),s=p(i,a),l=!1;if(t.isArray(r[a.id])||(r[a.id]=[]),i.trigger(e.afterValidateAttribute,[a,r[a.id]]),a.status=1,s.length){l=r[a.id].length>0;var d=i.find(a.container),o=d.find(a.error);l?(a.encodeError?o.text(r[a.id][0]):o.html(r[a.id][0]),d.removeClass(n.settings.validatingCssClass+" "+n.settings.successCssClass).addClass(n.settings.errorCssClass)):(o.empty(),d.removeClass(n.settings.validatingCssClass+" "+n.settings.errorCssClass+" ").addClass(n.settings.successCssClass)),a.value=g(i,a)}return l},h=function(e,i){var a=e.data("yiiActiveForm"),r=e.find(a.settings.errorSummary),n=r.find("ul").empty();r.length&&i&&(t.each(a.attributes,function(){if(t.isArray(i[this.id])&&i[this.id].length){var e=t("<li/>");a.settings.encodeErrorSummary?e.text(i[this.id][0]):e.html(i[this.id][0]),n.append(e)}}),r.toggle(n.find("li").length>0))},g=function(t,e){var i=p(t,e),a=i.attr("type");if("checkbox"===a||"radio"===a){var r=i.filter(":checked");return r.length||(r=t.find('input[type=hidden][name="'+i.attr("name")+'"]')),r.val()}return i.val()},p=function(t,e){var i=t.find(e.input);return i.length&&"div"===i[0].tagName.toLowerCase()?i.find("input"):i}}(window.jQuery);
